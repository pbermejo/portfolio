---
---
<div class="relative">
  <button
    id="theme-toggle-btn"
    type="button"
    class="text-paper-dark dark:text-charcoal-light hover:text-paper-tint dark:hover:text-charcoal-tint focus:outline-none p-2.5 transition-colors duration-200"
    aria-label="Toggle Theme"
  >
    <!-- Sun Icon -->
    <svg id="icon-light" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.591a.75.75 0 101.06 1.061l1.591-1.591zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.591-1.591a.75.75 0 10-1.061 1.06l1.591 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.591a.75.75 0 001.06 1.061l1.591-1.591zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"></path>
    </svg>
    <!-- Moon Icon -->
    <svg id="icon-dark" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
       <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
    </svg>
    <!-- System Icon (Computer Desktop) -->
    <svg id="icon-system" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" d="M2.25 6a3 3 0 013-3h13.5a3 3 0 013 3v7.5a3 3 0 01-3 3h-3v3.75h3a.75.75 0 010 1.5h-13.5a.75.75 0 010-1.5h3v-3.75h-3a3 3 0 01-3-3V6zm3-1.5a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H5.25z" clip-rule="evenodd" />
    </svg>
  </button>

  <div
    id="theme-dropdown"
    class="hidden absolute right-0 mt-2 w-32 bg-paper-light dark:bg-charcoal-mid border border-paper-mid dark:border-charcoal-dark rounded-md shadow-lg z-50 overflow-hidden"
  >
    <ul class="py-1">
      <li>
        <button
          class="flex items-center w-full px-4 py-2 text-sm text-paper-dark dark:text-charcoal-light hover:bg-paper-mid dark:hover:bg-charcoal-dark hover:text-paper-light"
          data-value="light"
        >
          <span class="mr-2">Light</span>
        </button>
      </li>
      <li>
        <button
          class="flex items-center w-full px-4 py-2 text-sm text-paper-dark dark:text-charcoal-light hover:bg-paper-mid dark:hover:bg-charcoal-dark hover:text-paper-light"
          data-value="dark"
        >
           <span class="mr-2">Dark</span>
        </button>
      </li>
      <li>
        <button
          class="flex items-center w-full px-4 py-2 text-sm text-paper-dark dark:text-charcoal-light hover:bg-paper-mid dark:hover:bg-charcoal-dark hover:text-paper-light"
          data-value="system"
        >
          <span class="mr-2">System</span>
        </button>
      </li>
    </ul>
  </div>
</div>

<script is:inline>
  const toggleBtn = document.getElementById('theme-toggle-btn');
  const dropdown = document.getElementById('theme-dropdown');
  const icons = {
    light: document.getElementById('icon-light'),
    dark: document.getElementById('icon-dark'),
    system: document.getElementById('icon-system'),
  };

  function updateIcon(theme) {
     Object.values(icons).forEach(icon => icon.classList.add('hidden'));
     if (icons[theme]) {
       icons[theme].classList.remove('hidden');
     }
  }

  // Initial Icon State
  const savedTheme = localStorage.getItem('theme') || 'system';
  updateIcon(savedTheme);

  // Toggle Dropdown
  toggleBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown.classList.toggle('hidden');
  });

  // Close Dropdown on outside click
  document.addEventListener('click', () => {
    if (!dropdown.classList.contains('hidden')) {
      dropdown.classList.add('hidden');
    }
  });

  // Handle Selection
  dropdown.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const value = btn.getAttribute('data-value');
        window.setTheme(value);
        updateIcon(value);
    });
  });
</script>
